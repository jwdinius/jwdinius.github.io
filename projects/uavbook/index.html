<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Fixed Wing Vehicle Autonomy | Joe Dinius, Ph.D.</title> <meta name="author" content="Joe Dinius, Ph.D."> <meta name="description" content="Full Stack Fixed Wing UAV Autonomy Simulation"> <meta name="keywords" content="robotics, autonomy, math, optimization, controltheory, planning, computervision"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?53ca2be8c4ec0d533ef79017d1a2d734"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jwdinius.github.io/projects/uavbook/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Joe </span>Dinius, Ph.D.</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">git</a> </li> <li class="nav-item "> <a class="nav-link" href="/learning/">learning</a> </li> <li class="nav-item "> <a class="nav-link" href="/assets/pdf/resumeDiniusTargeted.pdf">resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Fixed Wing Vehicle Autonomy</h1> <p class="post-description">Full Stack Fixed Wing UAV Autonomy Simulation</p> </header> <article> <p><img src="/assets/img/uavbook/RRT-path-planning.gif" alt="RRT"></p> <p><a href="https://github.com/jwdinius/uavbook/tree/jwd_solns" rel="external nofollow noopener" target="_blank">GitHub</a></p> <h2 id="abstract">Abstract</h2> <p>A full stack unmanned aerial vehicle (UAV) simulation is built using the <a href="https://github.com/randybeard/mavsim_public" rel="external nofollow noopener" target="_blank">starter project</a> provided by Dr. Randy Beard, one of the coauthors of <a href="http://press.princeton.edu/titles/9632.html" rel="external nofollow noopener" target="_blank">“Small Unmanned Aircraft: Theory and Practice</a>. The starter project is a companion to the book that walks students through the incremental development of the simulation using end-of-chapter design projects. The culmination of my work is the result seen above: <em>planning and executing a safe path through an urban environment using noisy sensor data and moderately gusty wind (over 10 feet/sec mean)</em>.</p> <h2 id="building-the-uav-simulation-block-by-block">Building the UAV simulation, block-by-block</h2> <p>The UAV system architecture can be decomposed into blocks; see the diagram below:</p> <p><img src="/assets/img/uavbook/uav-system-arch.png" alt="arch"></p> <p>source: <a href="http://press.princeton.edu/titles/9632.html" rel="external nofollow noopener" target="_blank">Beard and McLain, “Small Unmanned Aircraft: Theory and Practice”, Princeton University Press, 2012</a></p> <h3 id="the-unmanned-vehicle-block">The Unmanned Vehicle block</h3> <p>The “Unmanned Vehicle” block consists of the following elements necessary for simulation:</p> <ul> <li>Coordinate Frames (Chapter 2)</li> <li>Visualization (Chapter 2)</li> <li>Kinematics (Chapter 3)</li> <li>Dynamics (Chapter 4)</li> </ul> <h4 id="coordinate-frames">Coordinate Frames</h4> <p>Coordinate frames are important for all subsequent modeling and control methodologies to be discussed. The frames discussed in Chapter 2 define the angular and translational quantities that are used throughout the rest of the book.</p> <p>Arguably, the most important relationship presented in Chapter 2 is the <em>wind triangle</em>:</p> \[\begin{aligned} V_g \begin{bmatrix} \cos \chi \cos \gamma \\ \sin \chi \cos \gamma \\ -\sin \gamma \\ \end{bmatrix} - \begin{bmatrix} w_n \\ w_e \\ w_d \\ \end{bmatrix} = V_a \begin{bmatrix} \cos \psi \cos \gamma_a \\ \sin \psi \cos \gamma_a \\ -\sin \gamma_a \\ \end{bmatrix} \end{aligned}\] <p>What makes this relationship so important is that it can be used to infer the north, east, and down (inertial) components of the wind vector, \(\mathbf{w}\), from quantities that are measurable: ground speed (\(V_g\)), heading angle (\(\chi\)), flight path angle (\(\gamma\)), airspeed (\(V_a\)), yaw angle (\(\psi\)), and air-mass referenced flight path angle (\(\gamma_a\)).</p> <p>All coordinate frames presented are Cartesian, which is appropriate for small aircraft that don’t need to account for the curvature or rotation of the Earth.</p> <h4 id="visualization">Visualization</h4> <p>The first design project is to create a graphical representation of a small, fixed wing aircraft. My solution is implemented in this <a href="https://github.com/jwdinius/uavbook/commit/d02c5f542cc79be00f2626ef67a26d3e1e290225" rel="external nofollow noopener" target="_blank">commit</a>. I chose values that were in proportion to relative lengths observed in the model from page 26 of the book. I defined the 3D (body-relative) coordinates of the vehicle’s vertices and then created a triangular mesh from these points. The ordering of the vertices in the mesh matters; vertices must be ordered according to the right-hand rule. Triangular elements of the mesh must have <em>outward-facing</em> normals: when you curl your fingers along the difference vector between pairs of vertices, your thumb should point <em>away</em> from the vehicle’s surface.</p> <h4 id="kinematics">Kinematics</h4> <p>The six degree-of-freedom (DoF) equations-of-motion (EOM) for a rigid body moving through space are presented in Chapter 3. These EOM include translational and rotational motion in the presence of external forces and moments, respectively.</p> <h4 id="dynamics">Dynamics</h4> <p>Chapter 4 presents the full balance of forces and moments for a fixed wing aircraft. Forces and moments applied to the body are a result of the following dynamic effectors:</p> <ul> <li>Aerodynamic surfaces (including control surfaces)</li> <li>Throttle (e.g., applied by a propeller)</li> <li>Gravity</li> </ul> <p>The vehicle being modeled is <a href="https://www.grc.nasa.gov/www/k-12/VirtualAero/BottleRocket/airplane/turns.html#:~:text=A%20fundamental%20aircraft%20motion%20is,and%20raising%20the%20right%20aileron." rel="external nofollow noopener" target="_blank">“bank to turn”</a>. In order to turn, the vehicle must first initiate a roll maneuver to change the orientation of the vehicle’s control surfaces.</p> <p>The aerodynamic forces and moments are, to a large degree, matters of design: forces and moments scale linearly with air density (\(\rho\), which scales proportionally with altitude) and wing planform area (\(S\)), and quadratically with airspeed. The forces and moments are also linearly proportional to non-dimensional aerodynamic coefficients that can be linearized in Taylor expansions about a fixed point. Aircraft are normally designed such that they can achieve <em>static</em> stability; when the aircraft is perturbed away from a trim point (where forces and moments are in balance), the resulting aerodynamic forces and moments drive the vehicle back towards that same equilibrium. Control surfaces also affect the aerodynamics of the vehicle. As the name indicates, forces and moments arising from control surfaces are applied to drive the vehicle towards certain operational objectives, including:</p> <ul> <li>Altitude (\(h\))</li> <li>Airspeed (\(V_a\))</li> <li>Heading (\(\chi\))</li> </ul> <p>The forces and moments of this chapter are separated into two channels: <em>longitudinal</em> and <em>lateral</em>.</p> <p>The longitudinal dynamics consist of the lift and drag forces on the vehicle, as well as the pitching moment. These forces and moment are affected by control inputs from the throttle and elevator control surface, the body pitching rate, as well as the orientation of the vehicle’s velocity vector relative to wind (i.e., the angle-of-attack \(\alpha\)). Altitude and airspeed are consequences of the longitudinal forces and moments.</p> <p>The lateral dynamics are a consequence of the rudder and aileron control inputs, the body roll and yaw rates, as well as the the orientation of the vehicle’s velocity vector relative to wind (i.e., the sideslip angle \(\beta\)). The vehicle’s heading is a consequence of the lateral forces and moments.</p> <h3 id="the-autopilot-block">The Autopilot block</h3> <p>The “Autopilot” block is responsible for generating flight controls to stably achieve flight plan objectives for altitude, airspeed, and heading. Designing an autopilot, also called a flight controller, starts with creating reduced order models for the nonlinear dynamics of the vehicle. These models are presented in Chapter 5.</p> <p>The methods described in the book separate the full 6DoF EOM into lateral and longitudinal channels. The lateral and longitudinal channels are then further simplified into representative linear models. These linear models can be used to design flight controllers with feedback for each channel using proportional-integral-derivative (PID) controllers. Chapter 6 describes an approach for implementing PID controllers for both the lateral and longitudinal channels so that objectives can be met. The approach requires state feedback be available. For the purpose of motivating the autopilot design, true state feedback is used. State feedback based on sensor measurements and an observer model is presented later in the book.</p> <p>While decomposing the full EOM into channels is useful in simplifying controller design, the approach results in undesirable control coupling. As I describe in this <a href="/blog/2023/sim-autopilot">post</a>, other methods can be used that better account for this coupling. Two methods discussed in the post are <em>Linear Quadratic Regulator (LQR) control</em> and <em>Total Energy Control System (TECS) control</em>.</p> <p>LQR control seeks to analytically compute a control command that minimizes a control objective. This control objective is a quadratically-weighted balance between system error and control effort and must be carefully chosen by the control designer. LQR is mathematically precise, however it suffers when there is significant modeling error. Sources of modeling error in LQR include system modeling errors (like from forces and moments), truncation error (when trying to linearize a highly nonlinear system), and unmodeled disturbances (such as wind gusts).</p> <p>TECS control seeks to generate a control command that regulates the total energy (kinetic plus potential) of the aircraft while seeking to achieve the vehicle’s altitude, airspeed, and heading references. The TECS method proposed in the post is great because it better accounts for coupling between altitude and airspeed dynamics and because no linearization of the model is required. One drawback of this approach is that, when the vehicle encounters significant wind, an additional regulator (a PI controller in this case) must be added to remove steady-state errors in altitude and airspeed. These errors are a consequence of kinetic energy being a function of ground speed, not airspeed. Since airspeed is being regulated, a correction must be applied in addition to the TECS command. TECS is also fundamentally limited to longitudinal control since heading has no impact on the total energy of the system.</p> <p>In the post, I showed that the LQR controller works well when implemented for both channels, however the TECS controller better decouples airspeed and altitude dynamics. To get the best of both LQR and TECS, I implemented a hybrid controller <a href="https://github.com/jwdinius/uavbook/commit/61877cfc4c7617c350fcf6371ec57508f7c342b2#diff-d6a457f93a5c5603e778b39669858ceadba4b988c6b1b5ef2f4bbc28753a435f" rel="external nofollow noopener" target="_blank">here</a>. The results of this approach are shown below:</p> <p><img src="/assets/img/uavbook/autopilot-hybrid.gif" alt="hybrid autopilot"></p> <p>In the presence of moderate wind, the controller aggressively tracks step changes in its reference altitude, airspeed, and heading commands. The vehicle is clearly working hard to quickly eliminate errors and, in practice, such maneuvering is not necessary.</p> <p>Because the PID controller is simpler to tune and performs reasonably well, I used it for the remainder of the design projects.</p> <h3 id="the-state-estimator-block">The State Estimator block</h3> <p>Chapter 7 presents models for various UAV sensors, including:</p> <ul> <li>Accelerometers</li> <li>Gyroscopes</li> <li>Altimeters (Static Pressure)</li> <li>Airspeed sensors (Dynamic Pressure)</li> <li>Global Positioning System (GPS)</li> <li>Magnetometers</li> </ul> <p>Chapter 8 presents observer models to estimate the UAV’s state vector from sensor measurements. This state vector is then used as feedback to the autopilot.</p> <p>As described in this <a href="/blog/2023/sim-observer">post</a>, I made a number of modifications to the method presented in Chapter 8, including</p> <ul> <li>The inclusion of the magnetometer heading estimate</li> <li>The addition of vertical plane GPS measurements</li> <li>The fusion of the altimeter and GPS altitude measurements into a unified altitude estimate</li> <li>The dynamic adjustment of the observer model’s process noise based on how well the model prediction agrees with measurements.</li> </ul> <p>As shown below, the observer model tracks truth pretty well. This is especially notable considering there is no direct way of measuring wind using sensor estimates. Discrepancies are seen when a large step response in any reference input happens, but the estimates quickly converge back to the expected (i.e., true) values.</p> <p><img src="/assets/img/uavbook/observer.gif" alt="observer"></p> <h3 id="the-path-follower-block">The Path Follower block</h3> <p>Having established in the previous design projects that it is possible to command step changes in the vehicle’s altitude, airspeed, and heading using only estimates for state feedback, getting the vehicle to follow desirable paths is now possible. Perhaps simplistically, paths can be modeled as lines or circles. Chapter 10 presents methods for tracking a line or a circle in the presence of moderate wind. “Tracking” a path in this context means driving the error between the current UAV position in inertial coordinates and a point on the path to zero. This error is sometimes referred to as “crosstrack error”. The system behavior in response to a commanded line path is shown below:</p> <p><img src="/assets/img/uavbook/path-follower.gif" alt="path-follower"></p> <p>The plot above demonstrates how the vehicle manages its orientation to account for the effects of wind. If no wind were present, the vector between the nose and tail would be coincident with the linear path segment, which would mean zero angle-of-attack and sideslip angle.</p> <h3 id="the-path-manager-block">The Path Manager block</h3> <p>The path management techniques in Chapter 11 describe ways of performing missions that fly through a set of prescribed waypoints. A waypoint is point in 3D space that an operator would like the vehicle to fly to. A waypoint may or may not include a desired heading to achieve along with the 3D point in space.</p> <p>A path manager takes an input sequence of waypoints that an operator would like the vehicle to fly through. Internal to the path manager is a process for deconstructing waypoint sequences into line and circular arc segments so that vehicles can efficiently traverse paths between consecutive waypoints. The path manager also handles transitioning from the current target waypoint to the next when certain conditions are met. Three approaches to path management are presented in the chapter:</p> <ul> <li>Linear - <em>waypoints are connected by linear path objectives</em> </li> <li>Fillet - <em>the transition from one waypoint to another follows a circle connecting adjacent waypoint linear segments</em> </li> <li>Dubins - <em>paths between consecutive waypoints are deconstructed into three segments - an arc, followed by a line, concluded by an arc</em> </li> </ul> <p>Of the three options presented, only the Dubins approach ensures that generated paths actually fly through each prescribed waypoint. The Dubins approach also provides an operator the ability to prescribe a desired heading at each waypoint. Neither of the first two approaches gives this ability. Below are the results for an example “Figure-8” mission using the Dubins approach:</p> <p><img src="/assets/img/uavbook/dubins-path-manager.gif" alt="dubins-path-manager"></p> <h3 id="the-path-planner-block">The Path Planner block</h3> <p>The culmination of the book, in my opinion, is the presentation of material pertaining to path planning. Chapter 12 describes techniques for generating safe, i.e., collision-free, paths between starting and goal positions. These paths are simply a sequence of waypoints for which safe connecting paths are generated. Once planned, these waypoint sequences can be handed over to the path manager for execution. The results for the rapidly-exploring random tree (RRT) planner are shown at the beginning of this writeup.</p> <h3 id="afterword-target-tracking">Afterword: Target Tracking</h3> <p>I would have been fine if the authors had concluded the book with the chapter on path planning. However, as an added bonus, a chapter on target tracking and geolocation is presented. This is an important topic, so much so that I believe it should have been treated in a separate volume of this book so that it could be more thoroughly developed with respect to the following:</p> <ul> <li>Path planning - <em>how do you generate safe paths, including some minimum safe standoff distance?</em> </li> <li>Centering the target in the camera field-of-view (FoV)</li> <li>Estimating target motion in the image plane</li> </ul> <p>Still, I thought this was a valuable chapter and I will refer back to it regularly. Below are the results from Chapter 13’s design project for pointing the camera at a target.</p> <p><img src="/assets/img/uavbook/target-tracking.gif" alt="target-tracking"></p> <p>The error in estimating the state of the aircraft has clearly affects the position of the target in the image plane; the target is expected to be in the center of the FoV and it clearly is not. There are other issues as well, like the fact that even when the target is behind a building, the camera is still pointing at it.</p> <h2 id="wrap-up">Wrap-up</h2> <p>I learned a lot about fixed wing aircraft while working through the design projects from this book. The material is really interesting and the projects provide a fantastic way of reinforcing the lessons. I like that there are so many directions to which this material can be applied. Personally, I was most interested in flight controllers and state estimators when going through this book, so I focused a lot of my attention on the related chapters. If I were to go through this book again I would focus more on the later chapters. In particular, I would like to learn more about target-aware path planning.</p> <h1 id="thanks-for-reading">Thanks for reading!</h1> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Joe Dinius, Ph.D.. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>