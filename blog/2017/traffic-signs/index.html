<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Joe Dinius | Traffic Sign Classifier</title>
  <meta name="description" content="Project/Blog of Joe Dinius, Ph.D. Based on [*folio](https://github.com/bogoli/-folio) design.
">

  <link rel="shortcut icon" href="https://jwdinius.github.io/assets/img/favicon.ico">

  <link rel="stylesheet" href="https://jwdinius.github.io/assets/css/main.css">
  <link rel="canonical" href="https://jwdinius.github.io/blog/2017/traffic-signs/">
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
        
        <strong>Joe</strong> Dinius
    </span>
    

    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

      <div class="trigger">
        <!-- About -->
        <a class="page-link" href="https://jwdinius.github.io/">about</a>

        <!-- Blog -->
        <a class="page-link" href="https://jwdinius.github.io/blog/">blog</a>

        <!-- Pages -->
        
          
        
          
        
          
            <a class="page-link" href="https://jwdinius.github.io/learning/">learning</a>
          
        
          
        
          
            <a class="page-link" href="https://jwdinius.github.io/projects/">portfolio</a>
          
        
          
            <a class="page-link" href="https://jwdinius.github.io/publications/">publications</a>
          
        
          
        
          
        
          
        

        <!-- CV link -->
        <a class="page-link" href="https://jwdinius.github.io/assets/pdf/resumeDiniusTargeted.pdf">resume</a>

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Traffic Sign Classifier</h1>
    <p class="post-meta">April 10, 2017</p>
  </header>

  <article class="post-content">
    <h2 id="abstract">Abstract</h2>
<p>A traffic sign classifier is build using the LeNet-5 deep neural network topology.  Given a dataset containing images from 43 distinct classes from the <a href="http://benchmark.ini.rub.de/?section=gtsrb&amp;subsection=dataset">German Traffic Sign Dataset</a>, a classifier is built that obtains a 93% classification accuracy on a holdout set.  Class imbalances are addressed and corrected for, and an exploratory analysis of the dataset is performed.</p>

<hr />
<h2 id="load-the-data">Load The Data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># load the database (already been pickled)
</span>
<span class="n">training_file</span> <span class="o">=</span>  <span class="s">"../../traffic-signs-data/train.p"</span>
<span class="n">validation_file</span><span class="o">=</span> <span class="s">"../../traffic-signs-data/valid.p"</span>
<span class="n">testing_file</span> <span class="o">=</span>   <span class="s">"../../traffic-signs-data/test.p"</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">training_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">validation_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">testing_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">'features'</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="s">'labels'</span><span class="p">]</span>
<span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="s">'features'</span><span class="p">],</span> <span class="n">valid</span><span class="p">[</span><span class="s">'labels'</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s">'features'</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s">'labels'</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="dataset-summary--exploration">Dataset Summary &amp; Exploration</h2>

<p>The pickled data is a dictionary with 4 key/value pairs:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">'features'</code> is a 4D array containing raw pixel data of the traffic sign images</li>
  <li><code class="language-plaintext highlighter-rouge">'labels'</code> is a 1D array containing the label/class id of the traffic sign. The file <code class="language-plaintext highlighter-rouge">signnames.csv</code> contains id -&gt; name mappings for each id.</li>
  <li><code class="language-plaintext highlighter-rouge">'sizes'</code> is a list containing tuples, width, height, representing the original width and height the image.</li>
  <li><code class="language-plaintext highlighter-rouge">'coords'</code> is a list containing tuples, (x1, y1, x2, y2) representing coordinates of a bounding box around the sign in the image. <strong>THESE COORDINATES ASSUME THE ORIGINAL IMAGE. THE PICKLED DATA CONTAINS RESIZED VERSIONS, 32x32, OF THESE IMAGES</strong></li>
</ul>

<h3 id="provide-a-basic-summary-of-the-data-set">Provide a Basic Summary of the Data Set</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Use numpy methods to output metadata
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># Number of training examples
</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">"labels"</span><span class="p">].</span><span class="n">shape</span>

<span class="c1"># Number of testing examples.
</span><span class="n">n_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s">"labels"</span><span class="p">].</span><span class="n">shape</span>

<span class="c1"># What's the shape of an traffic sign image?
# after resizing, train["sizes"] gives original shapes, which are different from one another
</span><span class="n">image_shape</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">"features"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">shape</span>

<span class="c1"># How many unique classes/labels there are in the dataset?
</span><span class="n">n_classes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s">"labels"</span><span class="p">]))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Number of training examples ="</span><span class="p">,</span> <span class="n">n_train</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Number of testing examples ="</span><span class="p">,</span> <span class="n">n_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Number of validation examples = "</span><span class="p">,</span> <span class="n">valid</span><span class="p">[</span><span class="s">'labels'</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Image data shape ="</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Number of classes ="</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Number of training examples = (34799,)
Number of testing examples = (12630,)
Number of validation examples =  (4410,)
Image data shape = (32, 32, 3)
Number of classes = 43
</code></pre></div></div>

<h3 id="exploratory-visualization-of-the-dataset">Exploratory visualization of the dataset</h3>

<p>Some of what I think would be interesting would be frequency of class occurrence as a function of class.  It’s important to identify class imbalances that could negatively affect classification accuracy.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Data exploration visualization code goes here.
### Feel free to use as many code cells as needed.
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1"># Visualizations will be shown in the notebook.
</span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot class frequency
</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s">"labels"</span><span class="p">],</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Class Label'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'No. of Occurrences'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Traffic Sign Instances Observed in Training Set'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2100</span><span class="p">])</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_9_0.png" alt="png" /></p>

<hr />

<h3 id="there-is-an-apparent-class-imbalance">There is an apparent class imbalance…</h3>

<p>Some classes are really underrepresented in the dataset, as can be seen from the histogram above.  This will require some data augmentation.  However, I don’t want to get into augmenting until after other preprocessing has been done (normalization, standardization, etc…).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># code adapted from https://github.com/netaz/carnd_traffic_sign_classifier
</span><span class="kn">from</span> <span class="nn">skimage.color</span> <span class="kn">import</span> <span class="n">gray2rgb</span>
<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">gray</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">""</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    If 'i' is greater than 0, then plot this image as 
    a subplot of a larger plot.
    """</span>
    
    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nc</span><span class="p">))</span>
        
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(())</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">(())</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">nc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gray</span><span class="p">:</span>
        <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">gray2rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">image_rgb</span><span class="p">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">image_rgb</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_rgb</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pop_lbl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">37</span><span class="p">]</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">))):</span>
    <span class="n">pop_idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s">"labels"</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">"class={}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s">"features"</span><span class="p">][</span><span class="n">pop_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">],:,:,:],</span><span class="nb">len</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">),</span><span class="mi">4</span><span class="p">,</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_12_0.png" alt="png" /></p>

<hr />

<h3 id="some-images-are-rather-dark">Some images are rather dark…</h3>

<p>Images from classes 14 and 37 are very, very dark.  Some preprocessing is apparently necessary to identify the features present in these images.  More on this to come after the preprocessing section.</p>

<hr />

<h2 id="design-and-test-a-model-architecture">Design and Test a Model Architecture</h2>

<p>Here is where I will build the classifier that learns to recognize traffic signs. I will train and test this model on the <a href="http://benchmark.ini.rub.de/?section=gtsrb&amp;subsection=dataset">German Traffic Sign Dataset</a>.</p>

<p>The <a href="http://yann.lecun.com/exdb/lenet/">LeNet-5 implementation</a> is a solid point to start from.  It’s predominately been used for handwritten digit recognition a la MNIST, however its topology allows for robust feature extraction on more complex image sets.</p>

<p>There are various aspects to consider when thinking about this problem:</p>

<ul>
  <li>Neural network architecture (is the network over or underfitting?)</li>
  <li>Would preprocessing help; like normalization or colorspace conversion?</li>
  <li>Number of examples per label (some have more than others).</li>
  <li>Generate “fake” data.  This will address class imbalances already found.</li>
</ul>

<h3 id="preprocess-the-dataset">Preprocess the Dataset</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># define a couple of helper functions to preprocess the images
# preprocessing will allow the network to perform more robust feature extraction
</span>
<span class="c1"># Min-Max scaling for grayscale image data
# http://sebastianraschka.com/Articles/2014_about_feature_scaling.html#about-min-max-scaling
</span><span class="k">def</span> <span class="nf">normalize_scale</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>

<span class="c1"># http://lamda.nju.edu.cn/weixs/project/CNNTricks/CNNTricks.html
</span><span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">test_set</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_set</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">-=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">-=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># zero-center
</span>        <span class="n">X</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># normalize
</span>    <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rgb2gray</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.299</span><span class="p">,</span> <span class="mf">0.587</span><span class="p">,</span> <span class="mf">0.114</span><span class="p">])</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">gray</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gray</span>
    
<span class="c1"># preprocessing pipeline
</span><span class="k">def</span> <span class="nf">preprocess_dataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">test_set</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">rgb2gray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">normalize_scale</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">test_set</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span> <span class="o">=</span> <span class="n">preprocess_dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_valid</span> <span class="o">=</span> <span class="n">preprocess_dataset</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">preprocess_dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pop_lbl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">]</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">))):</span>
    <span class="n">pop_idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s">"labels"</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">"class={}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">pop_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">],:,:,:],</span><span class="nb">len</span><span class="p">(</span><span class="n">pop_lbl</span><span class="p">),</span><span class="mi">5</span><span class="p">,</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">gray</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_18_0.png" alt="png" /></p>

<hr />

<h3 id="the-features-are-more-resolved-with-the-preprocessing-steps">The features are more resolved with the preprocessing steps</h3>

<p>The images are now much more resolved and easier to discern with the naked eye.  Hopefully this will make the model’s classification accuracy higher.</p>

<hr />

<h3 id="augmenting-the-dataset-to-rebalance">Augmenting the dataset to rebalance</h3>

<p>To augment the dataset, the following methods can be employed from the skimage.ndimage package.  Images are rotated by some number of degrees, shifted by some number of pixels, or a combination of the two methods.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first define some helper functions
</span><span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="s">"""
    counts the number of instances of class in y
    """</span>
    <span class="n">n_counts</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="n">label</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#print(n_counts)
</span>    <span class="k">return</span> <span class="n">n_counts</span>

<span class="k">def</span> <span class="nf">class_images</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="s">"""
    Return a list containing all of the images of class 'img_class', 
    from dataset X
    """</span>
    <span class="n">n_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n_counts</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">img_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">n_counts</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">img_list</span>


<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">augment_class</span><span class="p">(</span><span class="n">class_images</span><span class="p">,</span> <span class="n">class_to_augment</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="n">nimages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_images</span><span class="p">)</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nimages</span><span class="o">/</span><span class="n">ncols</span><span class="p">)</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">listX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">listy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_x</span><span class="p">,</span><span class="n">_y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">listX</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
        <span class="n">listy</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><span class="s">'rotate'</span><span class="p">,</span> <span class="s">'shift'</span><span class="p">,</span> <span class="s">'rotate-shift'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">class_images</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">nimages</span><span class="p">)):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">orig_img</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">==</span><span class="s">'rotate'</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">orig_img</span><span class="p">,</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">==</span><span class="s">'shift'</span><span class="p">:</span>
                <span class="n">shift_size</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="n">shift</span><span class="p">(</span><span class="n">orig_img</span><span class="p">,</span> <span class="p">(</span><span class="n">shift_size</span><span class="p">,</span> <span class="n">shift_size</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#'bilinear'
</span>            <span class="k">elif</span> <span class="n">op</span><span class="o">==</span><span class="s">'rotate-shift'</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">orig_img</span><span class="p">,</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">shift_size</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="n">shift</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">shift_size</span><span class="p">,</span> <span class="n">shift_size</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#'bilinear'
</span>            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'unknown/unspecified augmentation operation'</span>
            <span class="n">listX</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">listy</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_to_augment</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">listX</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">listy</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">classes_to_augment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">]</span>
<span class="k">for</span> <span class="n">class_to_augment</span> <span class="ow">in</span> <span class="n">classes_to_augment</span><span class="p">:</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">class_images</span><span class="p">(</span><span class="n">class_to_augment</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">n_images</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">augment_class</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">class_to_augment</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done augmenting {} images to class {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">n_images</span><span class="p">,</span> <span class="n">class_to_augment</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Done augmenting 179 images to class 0
Done augmenting 359 images to class 6
Done augmenting 359 images to class 16
Done augmenting 179 images to class 19
Done augmenting 299 images to class 20
Done augmenting 269 images to class 21
Done augmenting 329 images to class 22
Done augmenting 449 images to class 23
Done augmenting 239 images to class 24
Done augmenting 539 images to class 26
Done augmenting 209 images to class 27
Done augmenting 239 images to class 29
Done augmenting 389 images to class 30
Done augmenting 209 images to class 32
Done augmenting 359 images to class 34
Done augmenting 329 images to class 36
Done augmenting 179 images to class 37
Done augmenting 269 images to class 39
Done augmenting 299 images to class 40
Done augmenting 209 images to class 41
Done augmenting 209 images to class 42
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot class frequency
</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Class Label'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'No. of Occurrences'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Traffic Sign Instances Observed in First Augmented Training Set'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2100</span><span class="p">])</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_23_0.png" alt="png" /></p>

<p>After the first augmentation, there still seem to be some imbalanced classes.  Let’s go through another augmentation on the imbalanced classes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">classes_to_augment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">]</span>
<span class="k">for</span> <span class="n">class_to_augment</span> <span class="ow">in</span> <span class="n">classes_to_augment</span><span class="p">:</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">class_images</span><span class="p">(</span><span class="n">class_to_augment</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">n_images</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">augment_class</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">class_to_augment</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done augmenting {} images to class {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">n_images</span><span class="p">,</span> <span class="n">class_to_augment</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"New training set size"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Done augmenting 359 images to class 0
Done augmenting 359 images to class 19
Done augmenting 479 images to class 24
Done augmenting 419 images to class 27
Done augmenting 419 images to class 32
Done augmenting 359 images to class 37
Done augmenting 419 images to class 41
Done augmenting 419 images to class 42
New training set size 47399
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot class frequency
</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Class Label'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'No. of Occurrences'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Traffic Sign Instances Observed in Second Augmented Training Set'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2100</span><span class="p">])</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_26_0.png" alt="png" /></p>

<h3 id="this-is-looking-passable-now">This is looking passable now…</h3>

<p>There’s appears to be no worse than a 4:1 class imbalance now!  This should be good enough to train on (or at least to try).</p>

<h3 id="model-architecture">Model Architecture</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>

<span class="kn">from</span> <span class="nn">tensorflow.contrib.layers</span> <span class="kn">import</span> <span class="n">flatten</span>

<span class="k">def</span> <span class="nf">LeNet</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>    
    <span class="c1"># Arguments used for tf.truncated_normal, randomly defines variables for the weights and biases for each layer
</span>    <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
    
    <span class="c1"># Layer 1: Convolutional. Input = 32x32x1. Output = 28x28x6.
</span>    <span class="n">conv1_W</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">conv1_b</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">conv1</span>   <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">conv1_W</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span> <span class="o">+</span> <span class="n">conv1_b</span>

    <span class="c1"># Activation.
</span>    <span class="n">conv1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv1</span><span class="p">)</span>

    <span class="c1"># Pooling. Input = 28x28x6. Output = 14x14x6.
</span>    <span class="n">conv1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">max_pool</span><span class="p">(</span><span class="n">conv1</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span>

    <span class="c1"># Layer 2: Convolutional. Output = 10x10x16.
</span>    <span class="n">conv2_W</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">conv2_b</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">conv2</span>   <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">conv1</span><span class="p">,</span> <span class="n">conv2_W</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span> <span class="o">+</span> <span class="n">conv2_b</span>
    
    <span class="c1"># Activation.
</span>    <span class="n">conv2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv2</span><span class="p">)</span>

    <span class="c1"># Pooling. Input = 10x10x16. Output = 5x5x16.
</span>    <span class="n">conv2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">max_pool</span><span class="p">(</span><span class="n">conv2</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span>

    <span class="c1"># Flatten. Input = 5x5x16. Output = 400.
</span>    <span class="n">fc0</span>   <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">conv2</span><span class="p">)</span>
    
    <span class="c1"># Layer 3: Fully Connected. Input = 400. Output = 120.
</span>    <span class="n">fc1_W</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">fc1_b</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
    <span class="n">fc1</span>   <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">fc0</span><span class="p">,</span> <span class="n">fc1_W</span><span class="p">)</span> <span class="o">+</span> <span class="n">fc1_b</span>
    
    <span class="c1"># Activation.
</span>    <span class="n">fc1</span>    <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span>

    <span class="c1"># Layer 4: Fully Connected. Input = 120. Output = 84.
</span>    <span class="n">fc2_W</span>  <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">84</span><span class="p">),</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">fc2_b</span>  <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">84</span><span class="p">))</span>
    <span class="n">fc2</span>    <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">fc1</span><span class="p">,</span> <span class="n">fc2_W</span><span class="p">)</span> <span class="o">+</span> <span class="n">fc2_b</span>
    
    <span class="c1"># Activation.
</span>    <span class="n">fc2</span>    <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">fc2</span><span class="p">)</span>
    <span class="c1">#fc2    = tf.nn.dropout(fc2, 0.5) # this actually hurt validation accuracy, maybe revisit?
</span>
    <span class="c1"># Layer 5: Fully Connected. Input = 84. Output = 43.
</span>    <span class="n">fc3_W</span>  <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">),</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">fc3_b</span>  <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_classes</span><span class="p">))</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">fc2</span><span class="p">,</span> <span class="n">fc3_W</span><span class="p">)</span> <span class="o">+</span> <span class="n">fc3_b</span>
    
    <span class="k">return</span> <span class="n">logits</span>
</code></pre></div></div>

<h3 id="train-validate-and-test-the-model">Train, Validate and Test the Model</h3>

<p>A validation set can be used to assess how well the model is performing. A low accuracy on the training and validation
sets imply underfitting. A high accuracy on the training set but low accuracy on the validation set implies overfitting.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">X_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">):</span>
    <span class="n">num_examples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_data</span><span class="p">)</span>
    <span class="n">total_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">get_default_session</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_examples</span><span class="p">,</span> <span class="n">BATCH_SIZE</span><span class="p">):</span>
        <span class="n">batch_x</span><span class="p">,</span> <span class="n">batch_y</span> <span class="o">=</span> <span class="n">X_data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="n">BATCH_SIZE</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="n">BATCH_SIZE</span><span class="p">]</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">accuracy_operation</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">batch_x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">batch_y</span><span class="p">})</span>
        <span class="n">total_accuracy</span> <span class="o">+=</span> <span class="p">(</span><span class="n">accuracy</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">total_accuracy</span> <span class="o">/</span> <span class="n">num_examples</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">128</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">int32</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">))</span>
<span class="n">one_hot_y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>

<span class="n">rate</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">logits</span> <span class="o">=</span> <span class="n">LeNet</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">cross_entropy</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax_cross_entropy_with_logits</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">one_hot_y</span><span class="p">)</span>
<span class="c1">#cross_entropy = tf.contrib.losses.softmax_cross_entropy(logits, labels, weight=1.0, scope=None)
</span><span class="n">loss_operation</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">cross_entropy</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">)</span>
<span class="n">training_operation</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss_operation</span><span class="p">)</span>

<span class="n">correct_prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">one_hot_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">accuracy_operation</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">correct_prediction</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### THIS IS THE MAIN EXEC OF THE PROJECT
### The training set is used to compute the weights of the neural network and it's accuracy on each 10th epoch 
### is reported
</span><span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="n">num_examples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"Training..."</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_examples</span><span class="p">,</span> <span class="n">BATCH_SIZE</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">BATCH_SIZE</span>
            <span class="n">batch_x</span><span class="p">,</span> <span class="n">batch_y</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">training_operation</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">batch_x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">batch_y</span><span class="p">})</span>
            
        <span class="n">validation_accuracy</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"EPOCH {} ..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Validation Accuracy = {:.3f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">validation_accuracy</span><span class="p">))</span>
            <span class="k">print</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">EPOCHS</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"EPOCH {} ..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Validation Accuracy = {:.3f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">validation_accuracy</span><span class="p">))</span>
            <span class="k">print</span><span class="p">()</span>
    
   
    <span class="n">saver</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">'./lenet'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Model saved"</span><span class="p">)</span>
    
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training...

EPOCH 1 ...
Validation Accuracy = 0.791

EPOCH 11 ...
Validation Accuracy = 0.902

EPOCH 21 ...
Validation Accuracy = 0.918

EPOCH 31 ...
Validation Accuracy = 0.929

EPOCH 41 ...
Validation Accuracy = 0.916

EPOCH 50 ...
Validation Accuracy = 0.932

Model saved
</code></pre></div></div>

<hr />

<h2 id="test-a-model-on-new-images">Test a Model on New Images</h2>

<p>To give more insight into how the model works, let’s test five pictures of German traffic signs from the web and use the model to predict the traffic sign type.  These images were not part of the original dataset, so we can get an idea of how good the classifier is on arbitrary German traffic signs, provided they are one of the classes in the dataset.</p>

<h3 id="load-and-output-the-images">Load and Output the Images</h3>
<p>Remember: the images must first be preprocessed to match the proper input to LeNet.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Load the images and plot them here.
### Feel free to use as many code cells as needed.
</span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'7501_Hoechstgeschwindigkeit_02.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'7501_stop_01.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">2</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'caution.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">3</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'end_no_passing.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">4</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'no_passing.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>

<span class="n">test_set</span> <span class="o">=</span> <span class="n">preprocess_dataset</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test_lbl</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_lbl</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">plot_image</span><span class="p">(</span><span class="n">test_set</span><span class="p">[</span><span class="n">j</span><span class="p">,:,:,:],</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">gray</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_38_0.png" alt="png" /></p>

<h3 id="predict-the-sign-type-for-each-image">Predict the Sign Type for Each Image</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Run the predictions here and use the model to output the prediction for each image.
</span><span class="n">new_saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="s">'lenet.meta'</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="n">new_saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s">'.'</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">test_set</span><span class="p">})</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maxes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">amax</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">maxes</span><span class="p">)))</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span><span class="n">cnt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">maxes</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">maxes</span><span class="p">))):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"(Prediction, Actual) = ({},{})"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">maxes</span><span class="p">[</span><span class="n">cnt</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">test_lbl</span><span class="p">[</span><span class="n">cnt</span><span class="p">]))</span>
    
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Prediction, Actual) = (1,3)
(Prediction, Actual) = (25,14)
(Prediction, Actual) = (18,18)
(Prediction, Actual) = (41,41)
(Prediction, Actual) = (9,9)
</code></pre></div></div>

<h3 id="analyze-performance">Analyze Performance</h3>

<p>As can be seen from the previous cell’s output, three of the five test were predicted correctly, giving an accuracy of 60%.  This isn’t bad, considering that class 1 has a high number of instances and class 14 images are pretty dark in the dataset.</p>

<h3 id="output-top-5-softmax-probabilities-for-each-image-found-on-the-web">Output Top 5 Softmax Probabilities For Each Image Found on the Web</h3>

<p>For each of the new images, print out the model’s softmax probabilities to show the <strong>certainty</strong> of the model’s predictions. <a href="https://www.tensorflow.org/versions/r0.12/api_docs/python/nn.html#top_k"><code class="language-plaintext highlighter-rouge">tf.nn.top_k</code></a> is a Tensorflow routine that outputs the top k probabilities.</p>

<p>The example below demonstrates how tf.nn.top_k can be used to find the top k predictions for each image.</p>

<p><code class="language-plaintext highlighter-rouge">tf.nn.top_k</code> will return the values and indices (class ids) of the top k predictions. So if k=3, for each sign, it’ll return the 3 largest probabilities (out of a possible 43) and the correspoding class ids.</p>

<p>Take this numpy array as an example. The values in the array represent predictions. The array contains softmax probabilities for five candidate images with six possible classes. <code class="language-plaintext highlighter-rouge">tk.nn.top_k</code> is used to choose the three classes with the highest probability:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># (5, 6) array
a = np.array([[ 0.24879643,  0.07032244,  0.12641572,  0.34763842,  0.07893497,
         0.12789202],
       [ 0.28086119,  0.27569815,  0.08594638,  0.0178669 ,  0.18063401,
         0.15899337],
       [ 0.26076848,  0.23664738,  0.08020603,  0.07001922,  0.1134371 ,
         0.23892179],
       [ 0.11943333,  0.29198961,  0.02605103,  0.26234032,  0.1351348 ,
         0.16505091],
       [ 0.09561176,  0.34396535,  0.0643941 ,  0.16240774,  0.24206137,
         0.09155967]])
</code></pre></div></div>

<p>Running it through <code class="language-plaintext highlighter-rouge">sess.run(tf.nn.top_k(tf.constant(a), k=3))</code> produces:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TopKV2(values=array([[ 0.34763842,  0.24879643,  0.12789202],
       [ 0.28086119,  0.27569815,  0.18063401],
       [ 0.26076848,  0.23892179,  0.23664738],
       [ 0.29198961,  0.26234032,  0.16505091],
       [ 0.34396535,  0.24206137,  0.16240774]]), indices=array([[3, 0, 5],
       [0, 1, 4],
       [0, 5, 1],
       [1, 3, 5],
       [1, 4, 3]], dtype=int32))
</code></pre></div></div>

<p>Looking just at the first row we get <code class="language-plaintext highlighter-rouge">[ 0.34763842,  0.24879643,  0.12789202]</code>, you can confirm these are the 3 largest probabilities in <code class="language-plaintext highlighter-rouge">a</code>. You’ll also notice <code class="language-plaintext highlighter-rouge">[3, 0, 5]</code> are the corresponding indices.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Print out the top five softmax probabilities for the predictions on the German traffic sign images found on the web. 
</span><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">tops</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">top_k</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="n">output</span><span class="p">)),</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tops</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TopKV2(values=array([[  1.00000000e+00,   5.76315484e-09,   1.25874606e-11,
          2.02269581e-12,   4.36664585e-15],
       [  9.89064455e-01,   9.48491786e-03,   5.03997027e-04,
          3.41146340e-04,   1.84364195e-04],
       [  1.00000000e+00,   7.57849783e-10,   3.18966655e-14,
          4.15005825e-15,   1.16327667e-16],
       [  9.99906659e-01,   5.87343457e-05,   1.69039595e-05,
          8.05835862e-06,   5.43485476e-06],
       [  9.91937459e-01,   5.52976551e-03,   2.06296914e-03,
          2.69575568e-04,   9.10933668e-05]], dtype=float32), indices=array([[ 1,  6,  2, 31, 32],
       [25, 24, 28, 29, 18],
       [18, 26, 27, 28, 20],
       [41, 32,  6, 42, 36],
       [ 9, 17, 41, 20, 16]], dtype=int32))
</code></pre></div></div>

<h4 id="just-out-of-curiosity">Just out of curiosity…</h4>

<p>There is a test set provided, how does the model perform on it?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="s">'lenet.meta'</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="n">new_saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s">'.'</span><span class="p">))</span>
    <span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Test Accuracy = {:.3f}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test Accuracy = 0.922
</code></pre></div></div>

<hr />

<h2 id="visualize-the-neural-networks-state-with-test-images">Visualize the Neural Network’s State with Test Images</h2>

<p>After successfully training a neural network you can see what its feature maps look like by plotting the output of the network’s weight layers in response to a test stimuli image. From these plotted feature maps, it’s possible to see what characteristics of an image the network finds interesting. For a sign, maybe the inner network feature maps react with high activation to the sign’s boundary outline or to the contrast in the sign’s painted symbol.</p>

<p>For an example of what feature map outputs look like, you could check out NVIDIA’s results in their paper <a href="https://devblogs.nvidia.com/parallelforall/deep-learning-self-driving-cars/">End-to-End Deep Learning for Self-Driving Cars</a> in the section Visualization of Internal CNN State. NVIDIA was able to show that their network’s inner weights had high activations to road boundary lines by comparing feature maps from an image with a clear path to one without.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Visualize the network's feature maps here.
</span>
<span class="c1"># image_input: the test image being fed into the network to produce the feature maps
# tf_activation: should be a tf variable name used during your training procedure that represents the calculated state of a specific weight layer
# activation_min/max: can be used to view the activation contrast in more detail, by default matplot sets min and max to the actual min and max values of the output
# plt_num: used to plot out multiple different weight feature map sets on the same block, just extend the plt number for each new feature map entry
</span>
<span class="k">def</span> <span class="nf">outputFeatureMap</span><span class="p">(</span><span class="n">image_input</span><span class="p">,</span> <span class="n">tf_activation</span><span class="p">,</span> <span class="n">activation_min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation_max</span><span class="o">=-</span><span class="mi">1</span> <span class="p">,</span><span class="n">plt_num</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Here make sure to preprocess the image_input in a way the network expects
</span>    <span class="c1"># Note: x should be the same name as your network's tensorflow data placeholder variable
</span>    <span class="c1"># If you get an error tf_activation is not defined it maybe having trouble accessing the variable from inside a function
</span>    <span class="n">activation</span> <span class="o">=</span> <span class="n">tf_activation</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">sess</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">image_input</span><span class="p">})</span>
    <span class="n">featuremaps</span> <span class="o">=</span> <span class="n">activation</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">plt_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">featuremap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">featuremaps</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">featuremap</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># sets the number of feature maps to show on each row and column
</span>        <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'FeatureMap '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featuremap</span><span class="p">))</span> <span class="c1"># displays the feature map number
</span>        <span class="k">if</span> <span class="n">activation_min</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;</span> <span class="n">activation_max</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">activation</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span> <span class="n">featuremap</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">"nearest"</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span><span class="n">activation_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">activation_max</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">activation_max</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">activation</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span> <span class="n">featuremap</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">"nearest"</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">activation_max</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">activation_min</span> <span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">activation</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span> <span class="n">featuremap</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">"nearest"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">activation_min</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">activation</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,</span> <span class="n">featuremap</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">"nearest"</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
            

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'7501_Hoechstgeschwindigkeit_02.jpg'</span><span class="p">).</span><span class="n">resize</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">)))</span>
<span class="n">image_input</span> <span class="o">=</span> <span class="n">preprocess_dataset</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">new_saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="s">'lenet.meta'</span><span class="p">)</span>
    <span class="n">new_saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s">'.'</span><span class="p">))</span>
    
    <span class="n">conv_1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">get_default_graph</span><span class="p">().</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s">"Conv2D_1:0"</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">image_input</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">outputFeatureMap</span><span class="p">(</span><span class="n">image_input</span><span class="p">,</span> <span class="n">conv_1</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_51_0.png" alt="png" /></p>

<p><img src="/assets/img/Traffic_Sign_Classifier/output_51_1.png" alt="png" /></p>

<p>Any layer in the network could be used to identify which features were most important to that layer.  From this, the user can see that neural networks aren’t merely a “black box”; each layer refines a greater level of detail than the one previous.</p>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'https-jwdinius-github-io';
      var disqus_identifier = '/blog/2017/traffic-signs';
      var disqus_title      = "Traffic Sign Classifier";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

      </div>
    </div>

    <footer>

  <div class="wrapper">
    &copy; Copyright 2023 Joe Dinius.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="https://jwdinius.github.io/assets/js/common.js"></script>





<!-- Include custom icon fonts -->
<link rel="stylesheet" href="https://jwdinius.github.io/assets/css/fontawesome-all.min.css">
<link rel="stylesheet" href="https://jwdinius.github.io/assets/css/academicons.min.css">

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-XXXXXXXXX', 'auto');
ga('send', 'pageview');
</script>


  </body>

</html>
