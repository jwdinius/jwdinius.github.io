<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Acrobot | Joe Dinius, Ph.D.</title> <meta name="author" content="Joe Dinius, Ph.D."> <meta name="description" content="an introduction to the acrobot, the coolest simple nonlinear system you've probably never heard of"> <meta name="keywords" content="robotics, autonomy, math, optimization, controltheory, planning, computervision"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?df44dccb15554b4d2d173cb203488555"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?53ca2be8c4ec0d533ef79017d1a2d734"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jwdinius.github.io/blog/2017/acrobot/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Joe </span>Dinius, Ph.D.</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">git</a> </li> <li class="nav-item "> <a class="nav-link" href="/learning/">learning</a> </li> <li class="nav-item "> <a class="nav-link" href="/assets/pdf/resumeDiniusTargeted.pdf">resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Acrobot</h1> <p class="post-meta">October 24, 2017</p> <p class="post-tags"> <a href="/blog/2017"> <i class="fas fa-calendar fa-sm"></i> 2017 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h3 id="summary">Summary</h3> <ul> <li>The acrobot is a low-dimensional nonlinear dynamical system that can be used to motivate ideas of nonlinear control for more complicated systems.</li> <li>Control strategies for both feedback and open-loop trajectory generation are presented with computational results highlighting key points.</li> </ul> <h3 id="introduction">Introduction</h3> <p>Let’s start with a picture:</p> <p align="center"> <img src="/assets/img/A1.png"> </p> <p>This image represents the physical layout of a pretty cool robotic system known as the <em>acrobot</em>. The system consists of two bars, <span style="color:red">red</span> and <span style="color:blue">blue</span>, and two joints. One of the two joints is connected to the ceiling, while the other links the two bars. This latter joint is where the fun comes in; this joint is actuated! Ok, ok, maybe it’s not that exciting, but I think that it’s pretty cool. Being able to control the angle $q_2$ from the picture directly will allow us to do some pretty neat things later; like making the acrobot point up against gravity or catch a thrown ball. More on this later.</p> <h3 id="why-study-the-acrobot">Why study the acrobot?</h3> <p>So many reasons…</p> <ul> <li>The acrobot is complex enough to exhibit chaotic behavior while not being so complex as to be mathematically intractable.</li> <li>Like many complex robots, the acrobot is <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-832-underactuated-robotics-spring-2009/readings/MIT6_832s09_read_ch01.pdf" target="_blank" rel="external nofollow noopener">underactuated</a>, meaning that it is impossible to make it follow any arbitrary trajectory.</li> <li>Controlling the acrobot provides a great introduction to methods of control for more complex systems.</li> </ul> <h3 id="motivation">Motivation</h3> <p>I’ll only touch on some key points here; for a more complete treatment, see <a href="http://ieeexplore.ieee.org/document/341864/" rel="external nofollow noopener" target="_blank">Sprong</a> or <a href="http://underactuated.csail.mit.edu/underactuated.html" target="_blank" rel="external nofollow noopener">Tedrake</a>.</p> <p>The acrobot’s state \(\mathbf{x}\) at any given time is described by the following vector:</p> \[\mathbf{x} = \begin{pmatrix} q_1 \\ q_2 \\ \dot q_1 \\ \dot q_2 \end{pmatrix},\] <p>and the control input is $u = \ddot q_2$; the actuator can directly change the angular acceleration of $q_2$ only.</p> <p>I will try and achieve two goals with the acrobot in this post:</p> <ul> <li>Make the acrobot <em>stand up</em>, meaning balancing the acrobot upright.</li> <li>Make the acrobot catch a thrown ball.</li> </ul> <p>The second bullet will follow partially as a consequence of work towards achieving the first. To actually make the acrobot balance requires a few different controllers as it turns out. To motivate why, let’s start by considering how the acrobot moves when the control strategy is poor. Below you’ll find a link to a video showing a really rough and poorly actuated trajectory of the acrobot trying to stand up.</p> <p><a href="https://www.youtube.com/watch?v=IehcrBnQH4c" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/IehcrBnQH4c/0.jpg" alt="badTune"></a></p> <p>This behavior is suboptimal to be sure, so let’s go through how we might make it better.</p> <h3 id="control">Control</h3> <h4 id="lqr">LQR</h4> <p>Personally, I like to start controlling nonlinear systems near equilibria. Dealing with minor disturbances once I’ve gotten there is easy: just use <a href="https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator" target="_blank" rel="external nofollow noopener">LQR</a>. LQR is an optimal control law, meaning that given a desired objective, usually minimizing cost given a set of simplifying assumptions, it’s the best control law we can construct. The desired objective is usually minimizing error between current and desired states.</p> <p>State evolution using LQR is written as</p> \[\mathbf{x}_k \approx A (\mathbf{x}_{k-1} - \mathbf{x}_d) + B u,\] <p>where</p> <ul> <li>\(\mathbf{x}_k\) is the state vector at time \(k\)</li> <li>\(A\) is the state Jacobian matrix</li> <li>\(\mathbf{x}_d\) is the desired state vector</li> <li>\(B\) is the control Jacobian matrix</li> </ul> <p>The control law for LQR is derived as</p> \[u = -K (\mathbf{x}-\mathbf{x}_d),\] <p>where $K$ is the optimal gain discussed in the <a href="https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator" target="_blank" rel="external nofollow noopener">first section here</a>.</p> <p>LQR is great, but only when the dynamics of the acrobot are mostly linear, and this assumption is valid near equilibria <em>only</em>. What about away from equilibria?</p> <h4 id="partial-feedback-linearization">Partial feedback linearization</h4> <p><a href="http://www.lirmm.fr/~chemori/Temp/Chaimaa/bergerman95experimental.pdf" target="_blank" rel="external nofollow noopener">Sprong</a> developed a technique for underactuated robotic control that could partially linearize the system. I’ll only state the control law here, but you should <a href="http://www.lirmm.fr/~chemori/Temp/Chaimaa/bergerman95experimental.pdf" target="_blank" rel="external nofollow noopener">check this out</a> for more details if you’re interested. The basic idea stems from the fact that fully actuated robots are feedback linearizable, whereas underactuated robots are not. Partial feedback linearization seeks to simplify the underactuated system as much as possible given the number of controllable degrees of freedom.</p> <p>We will start with the acrobot <a href="http://robotics.itee.uq.edu.au/~metr4202/2013/lectures/Remotely%20Driven%202%20DOF%20Arm%20-%20Asada%20and%20Slotine.pdf" target="_blank" rel="external nofollow noopener">manipulator dynamic equations</a>:</p> \[\ddot q_2 = H^{-1} (Bu - C) \\ B = \begin{pmatrix} 0 \\ 1 \end{pmatrix}, C = \begin{pmatrix} C_1 \\ C_2 \end{pmatrix}, H^{-1} = \begin{pmatrix} a_1 &amp; a_2 \\ a_2 &amp; a_3 \end{pmatrix}.\] <p>The constants \(C_1, C_2, a_1, a_2, a_3\) are all system-specific and don’t matter much for our general discussion of the method. Now, the gist of partial feedback linearization is that we want a control law such that \(\ddot q_2 = y\), but what should \(y\) be? I’d argue that \(y\) should be something of the form \(y = k_1 q_2 + k_2 \dot q_2\), for some fixed <em>negative</em> gains \(k_1, k_2\). Why does this make sense? The negative feedback acts to oppose large rate change. This is definitely not a rigorous argument, this is a blog post after all <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20">. However, in the results that will be presented, the controller works pretty well. The partial feedback linearization control law is written out explicitly as:</p> \[u = \frac{1}{a_3}(y + a_2 C_1) + C_2.\] <h4 id="energy-shaping">Energy shaping</h4> <p>This is arguably the most ad hoc controller that will be presented, but it works. In fact, it works pretty darned well; even far from equilibrium. The total energy of any physical system, which includes the acrobot, is the sum of the potential, \(V\), and kinetic, \(T\), energies: \(E = T + V\). It would be desirable to construct a feedback control that sought out a desired energy, i.e. the potential energy an equilibrium point. Such a control law exists, and it’s construction is known as <em>energy shaping</em>. The law is written out as:</p> \[u = k(E_d - E)\dot q_2,\] <p>where \(E_d\) is the system’s energy at the desired position in state space. For details of this control law, see <a href="http://underactuated.csail.mit.edu/underactuated.html?chapter=3" target="_blank" rel="external nofollow noopener">Tedrake, Section 3.5</a>.</p> <h4 id="trajectory-planning">Trajectory Planning</h4> <p>Trajectory planning is super cool, and I’d love to get way into this here, but I don’t want to derail the discussion of the acrobot. I’ll write more on trajectory planning methods in future posts, so fret not.</p> <h5 id="what-is-trajectory-planning">What is trajectory planning?</h5> <p>If the dynamics of the system are well known, there are a number of analytical tools that can be brought to bear in executing desired movements. Specifically, we can construct a control sequence that optimizes system response. In this context, I’d say that <em>optimizes system response</em> means <em>minimizes control effort</em>, but you can create your own cost function to suit your problem.</p> <p>The results presented in this post utilize a method known as <a href="http://underactuated.csail.mit.edu/underactuated.html?chapter=12" target="_blank" rel="external nofollow noopener">direct collocation</a>. We break up a starting trajectory into points along that trajectory. These points are called <em>knots</em>. The trajectories between knots are modeled as polynomials of the form:</p> \[\mathbf{q}_{i}(t) = b_0 + b_1 (t-t_i) + b_2 (t-t_i)^2 \dots + u_i\] <p>with coefficients \(b_i\) chosen such that the polynomials are \(C^1\) continuous at the knot points. \(C^1\) continuity means continuous with continuous first derivative. The problem then becomes how do we construct a sequence of controls \(\{u_1, u_2, \cdots\}\) at the knot points that matches the system dynamics and is optimal with respect to a desired cost function? We can do so relatively simply, it turns out, with CONSTRAINED OPTIMIZATION!! The constrained optimization problem to be solved can be stated explicitly as:</p> <blockquote> <p>Assuming a piecewise polynomial representation of \(\mathbf{q}(t)\), find the control sequence \(\{u_1, u_2, \cdots\}\) at knots \(\{ \mathbf{q}_1, \mathbf{q}_2, \cdots \}\) constrained by the given system’s dynamics that minimizes overall cost, which can be represented as a function: \(C( \{\mathbf{q}_i\}, \{u_i\})\).</p> </blockquote> <p>Typical costs are:</p> <ul> <li>Minimize control effort: like minimizing fuel consumption of a spacecraft.</li> <li>Minimize path length in state space: like a line integral along a trajectory</li> <li>Minimize jerk: if there are desired comfort constraints, you can construct a control sequence to avoid excessive jostling</li> </ul> <h5 id="why-trajectory-planning">Why trajectory planning?</h5> <p>Well, it’s totally awesome for one thing; breaking down complicated control problems into simpler subproblems and letting a computer crunch out an optimal solution is a nice merging of physics and computation. Personally, I like that it’s a way of exploiting prior system knowledge to construct a controller that utilizes more than current state feedback.</p> <p>I’ll do more posts on trajectory planning in the future, so stay tuned.</p> <h3 id="results">Results</h3> <p>I’ll now go through some results that I generated using CSAIL’s <a href="http://drake.mit.edu/" target="_blank" rel="external nofollow noopener">Drake</a> API. This is a nice package for investigating control of real nonlinear dynamical systems. It’s well documented for the most part and it does a lot of cool things out of the box. Like all niche software, though, be prepared to put in some serious effort learning the API.</p> <h4 id="standing-up">Standing up</h4> <p>The first question I’ll address is: How can I make the acrobot stand upright? From basic systems theory, we know that the acrobot has two equilibria: a stable point with \(q_1=q_2=0, \dot q_1=\dot q_2 = 0\) and an unstable point with \(q_1=\pi, q_2=0, \dot q_1=\dot q_2 = 0\). The stable equilibrium is so because the system has lowest possible energy, whereas the unstable equilibrium has higher potential energy. Standing the acrobot up is challenging because any kind of unaccounted-for disturbance about the upright equilibrium will allow gravity to pull the system downward towards the stable equilibrium.</p> <p>Let’s start with the video link presented earlier; the one showing how chaotic the system can be with improperly applied feedback control:</p> <p><a href="https://www.youtube.com/watch?v=IehcrBnQH4c" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/IehcrBnQH4c/0.jpg" alt="badTune"></a></p> <p>Clearly, there’s some work to be done here. The system response is erratic and hints at the presence of low-dimensional chaos, specifically:</p> <ul> <li>lack of periodicity</li> <li>irregular speedup/slowdown</li> </ul> <p>If we start far from the equilibrium, I suspect that LQR won’t be very effective, so I’ll look at using the other two controllers first; maybe they will be enough. The video link below shows results using partial feedback linearization and energy shaping control:</p> <p><a href="https://www.youtube.com/watch?v=4HuwLA4BUW4" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/4HuwLA4BUW4/0.jpg" alt="swingup nolqr"></a></p> <p>Ok, these controllers get us close to the goal. Once there, though, the controllers don’t have fine enough resolution to keep the system there indefinitely. I’ll bet LQR could be applied exclusively once we get close enough to the equilibrium. I’ve added a condition to the controller to only use LQR once the <a href="https://stanford.edu/class/ee363/lectures/clqr.pdf" rel="external nofollow noopener" target="_blank">cost-to-go</a> has gotten sufficiently small. Results utilizing this new controller applied to the original problem are linked below:</p> <p><a href="https://www.youtube.com/watch?v=38QEe6l5pvM" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/38QEe6l5pvM/0.jpg" alt="swingup"></a></p> <p>Whoa! Much better! The controller actually stabilizes the acrobot about the desired point, and quickly so. The big takeaways here are:</p> <ul> <li>Energy shaping and PFL controllers are useful for points far from the upright equilibrium</li> <li>LQR is useful for disturbance rejection near the upright equilibrium.</li> </ul> <h4 id="catching-a-thrown-ball">Catching a thrown ball</h4> <p>Now, for something more challenging: Can we get the acrobot to catch something? There are a lot of implementation details here that I won’t discuss; such as creating the system Jacobian matrix, objective construction, etc… I only aim to show that Drake can be used to construct a trajectory for catching a ball with well-known, and perturbed, system dynamics. The basic idea here is that direct collocation is used for generating an optimal control sequence for catching the ball with the acrobot.</p> <p>First, the easiest case; assume we have perfect state information. See the video link below:</p> <p><a href="https://www.youtube.com/watch?v=rzzB-EnHQGs" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/rzzB-EnHQGs/0.jpg" alt="catch"></a></p> <p>Nice; the acrobot wiggles about and catches the ball at the end of the second bar. Now would be a natural point to discuss trajectory planning in general. The trajectory shown above was planned using perfect information, i.e. it is <em>open-loop</em>. In the real-world, we can typically compile pretty good, though imperfect, information. How well does the planned trajectory do if we perturb the system? At this point, we have <em>pretty good</em> state information; but how sensitive is our solution to small changes?</p> <p><a href="https://www.youtube.com/watch?v=fDE-I1IGxGw" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/fDE-I1IGxGw/0.jpg" alt="nocatch"></a></p> <p>I guess the answer to the previous question is: pretty darned sensitive! Perhaps there is a way to stabilize our open-loop solution with feedback control. What I’m thinking is that our open-loop trajectory is kind of like a stable structure in our problem space, and perturbing this would result in something that might lie along a mostly-linear extension of that stable structure. So, perhaps, we could implement an LQR controller that would keep the dynamics of the perturbed system in the linear regime allowing us to account for perturbations to the original open-loop trajectory. Let’s see if such a solution would work:</p> <p><a href="https://www.youtube.com/watch?v=ceBtbJHR4Rw" target="_blank" rel="external nofollow noopener"><img src="https://img.youtube.com/vi/ceBtbJHR4Rw/0.jpg" alt="catchp"></a></p> <p>Cool! It worked!</p> <h3 id="conclusion">Conclusion</h3> <p>I’ve presented a lot of content with little technical detail. I encourage you to comment with kudos and suggestions for content improvement. I’ve tried to link to sources that provide clarification and deeper exploration of the content presented within this post, but if anything is lacking please say so. I really like working with the acrobot; I think it’s a cool system for presenting ideas to try for more complicated systems. Thanks for reading!</p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Joe Dinius, Ph.D.. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>