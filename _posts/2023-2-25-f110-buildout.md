---
layout: post
title: Building the F1TENTH Racecar
description: Walkthrough of my build of the F1TENTH autonomous RC racecar.
date:   2023-05-01 12:00:00
comments: true
---

I feel like I have been putting together my Traxxas RC car _forever_.  When I started back in 2017, the [F1TENTH project](https://f1tenth.readthedocs.io/en/stable/getting_started/intro.html#doc-build-intro) wasn't even a thing yet.  Luckily for me, the documentation in this project is pretty easy to follow.  I highlight some notable exceptions below.

## Bill-of-Materials (BoM)

For the most part, the [Master BoM](https://docs.google.com/spreadsheets/d/1WT-UdjLTnyrb7CvHcuCxKLnRIN8DWroQ/edit#gid=606618920) is pretty good.  There were two areas that required additional research on my part though:

1. Which material to choose for the laser-cut platform deck?
1. Which materials to choose for the power distribution module (PDM)?

For the first item, it took some iteration.  I started by ordering two black matte acrylic platform decks from [Ponoko](https://www.ponoko.com/) but I snapped both of them when assembling the car.  For the next order, I tried two stronger (and more expensive) materials - Black Melamine and Black Delrin.  I installed the Black Delrin deck and it worked out fine.

The second item required me to do some digging in the [f1tenth forums](https://groups.google.com/g/f1_10/c/GGuCTB-l78Y).  Thankfully, I was able to find an [updated BoM](https://docs.google.com/spreadsheets/d/1tbXGLgL5GAHyR6L9F-SnwSzdjveUt-EyJ4-mb8ZAkkw/edit#gid=718958730) there.

Though it is not called out directly in the BoM, a valuable piece of test equipment to have is a digital power supply like [this one](https://www.amazon.com/Siglent-Technologies-SPD3303X-Triple-Output/dp/B01410O424/ref=sr_1_3_pp?crid=1784OTMM5TCAP&keywords=siglent+power+supply&qid=1702946599&sprefix=siglent+%2Caps%2C156&sr=8-3).  Although it can't be used to power the VESC when it is driving the motors (more on this in the [VESC](#setting-up-the-vesc) section below), it can be used while setting up the rest of the physical setup, including the Jetson computer.

The primary reason it took me so long to put this kit together is the all-in price tag: _about $3k_.  This is pretty steep for a hobbyist like me, but I finally was able to pull everything together earlier this year.

## Traxxas modifications

The steps [here](https://f1tenth.org/build.html) were performed with no modifications required.  As I mentioned previously, I had some issues with the platform deck material having insufficient integrity to be properly installed.

I added the foam front fender from the [RACECAR/J kit](https://racecarj.com/collections/mit-racecar-build-series/products/racecar-j-robot-base-kit) to lessen the impact of any collisions.

## Building the Power Distribution Module (PDM) 

The PDM takes in a variable voltage and outputs regulated voltage on 12 and 8V output buses.  The 12V output is primarily to power the Jetson NX companion computer.  The 8V output is for powering the Hokuyo lidar sensor.

I am not an electrical engineer nor am I an electronics technician.  It has been several years since I have had to solder anything, so I had to proceed more carefully through this step.

### Soldering the PDM

The first consideration in soldering was [ordering](https://oshpark.com/shared_projects/qvIKu3aY) the printed circuit board (PCB) to add the electronic components to.  The vendor (Oshpark) requires a minimum of three PCBs per order for fabrication, so I decided to build three full PDM assemblies.  This would provide adequate backup should I blow up any of them along the way.

I remembered from my introductory electronics lab in college that certain electronic components, like diodes, have polarity; that is, there are preferred mounting orientations of components relative to current flow through a circuit.  I did not recall that capacitors had polarity, so it was a good thing I found [this diagram](https://www.yamanelectronics.com/capacitor-anode-cathode-identification/):

![test-image]({{ site.baseurl }}{% link /assets/img/capacitor-polarity.jpg %})

Some capacitors do have polarity - there is an anode (+) and a cathode (-) and you need to make sure to install these components correctly.  Polarized capacitors are noted in schematics differently than non-polarized ones; see picture above.

Specific to the printed PDM PCB: _the anode has a longer lead than the cathode and should be installed in the hole nearest the printed component id_.  Below is a picture of the assembled PDM showing the correct orientations of the polarized electrolytic capacitors.

![pdm-closeup]({{ site.baseurl }}{% link /assets/img/pdm-closeup.jpg %})

The only word of advice I can give would-be builders here is this: _get a really fine tip for your soldering iron_.  Some of the work is rather delicate.  You will want some means (like [this](https://www.amazon.com/Soldering-Flexible-Flashlight-Magnifying-Aluminum/dp/B085958VNK/ref=asc_df_B085958VNK/?tag=&linkCode=df0&hvadid=416720562944&hvpos=&hvnetw=g&hvrand=54914317156848057&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9031172&hvtargid=pla-909563369713&mcid=60085f6ba32334598761ffc8385d6d82&ref=&adgrpid=95471657178&gclid=CjwKCAiA-P-rBhBEEiwAQEXhH-rqM7q51hxpmGqH7QWW_CrC0ReTt-2zarHQYwnELQpLTs_ckqdYRxoCWXMQAvD_BwE&th=1)) of keeping the board fixed without having to hold it with a free hand.

### Testing

Testing is actually pretty straightforward: get a [hand-held multimeter](https://www.adafruit.com/product/2034?gad_source=1&gclid=CjwKCAiA-P-rBhBEEiwAQEXhH2qsnGjb8U37sZ3gdhta1t6iTGKZmXSWB3hyjtttOUlLtYb52cwPRhoCRtUQAvD_BwE) and put some voltage (10-24V) across one of the output channels on your power supply.  Toggle the on/off switch on each PDM and then check the voltage across each pair in your output bus to make sure the correct voltage - either 12 or 8V - is indicated.

<p float="left">
  <img src="/assets/img/pdm-8V.jpg" width="320" />
  <img src="/assets/img/pdm-12V.jpg" width="320" /> 
</p>

## Setting up the Jetson

As indicated in the Master BoM spreadsheet, Nvidia no longer produces the Xavier NX developer kits.  The recommended alternative is the Seeed Studio [reComputer J2021](https://www.seeedstudio.com/reComputer-J2021-p-5438.html) system-on-module (SoM).  This SoM doesn't have a Wi-Fi card installed, so I had to buy one.  Nvidia lags pretty far with respect to releases of their Linux kernel and, as such, the Jetson is limited in terms of what wireless cards it can support.  I tried a few Intel cards, but only the [Intel 8265NGW](https://www.amazon.com/Intel-Dual-Band-Wireless-Ac-8265/dp/B01MZA1AB2/ref=sr_1_3?crid=1YDDJON2VFI4G&keywords=intel+8265&qid=1702996569&sprefix=intel+8265%2Caps%2C177&sr=8-3) was recognized by the kernel.

I also added an [M2 SSD](https://www.amazon.com/gp/product/B09DVQQL9G/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&th=1) to add storage capacity to the device.

## Adding a camera

The front fender addition from the RACECAR/J came with a mounting plate that can support a [ZED 2 stereo camera](https://store.stereolabs.com/products/zed-2).  I had a ZED 2 from a prior project, so I added it using glue.  The connection feels solid, but I have my concerns that it won't survive racing conditions.

## Putting it all together

Here's a picture of the finished build:

![f1tenth-build]({{ site.baseurl }}{% link /assets/img/f1tenth-build.jpg %})

## What's next?

Now I need to get all of the electronic peripherals - the sensors, the motor controller, and the Jetson - setup properly.  I'll let you know how it goes.